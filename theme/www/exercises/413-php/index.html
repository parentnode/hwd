<!DOCTYPE html>
<html lang="en">
<head>
	<title>Exercise 413</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<link rel="stylesheet" type="text/css" href="/css/exercises/includes.css" />
	<script type="text/javascript" src="/js/exercises/includes.js"></script>
</head>
<body>


<div id="page" class="i:page">
	<div id="header"></div>
	<div id="content">

		<div class="scene i:exercise">
			<h1>Exercise 413 - Janitor Items</h1>
			<p>
				This exercise is about Janitor Items.
			</p>
			<p>
				The purpose of this exercise is to work with your personal Janitor project to gain experience
				with PHP and Janitor.
			</p>

			<h2>Understanding Items</h2>
			<h3>Models</h3>
			<p>
				Janitor models allow you to add dynamic content to your project. Each model, whether it is
				a default Janitor model or a model you have created, specifies an Itemtype. A TypePost model
				defines a <em>post</em> itemtype. A TypeArticle defines an <em>article</em> itemtype.
				A model allows you to create an infinite number of Items in the database based on this model.
			</p>
			<p>
				For the sake of terminology, each time you add content to your system, either via a backend interface or via 
				API requests, this becomes a new Item of a specific Itemtype in the Database.
				A <em>post</em>, a <em>person</em>, an <em>article</em> – even a whole <em>page</em> in some cases.
				You can use or create models, depending on what level of specificity you need.
			</p>
			<p>
				The Janitor model specification files are named 
				<em>type.#itemtype#.class.php</em> and the classes <em>Type#Itemtype#</em>. The files are located in
				the <em>classes/items</em> folder of your project.
			</p>
			<p>
				The Janitor default models are found in <em>submodules/janitor/janitor/src/classes/items</em>.
				They all come with a full backend interface, with controllers found in 
				<em>submodules/janitor/janitor/src/www/#itemtype#.php</em> and templates found in 
				<em>submodules/janitor/janitor/src/templates/janitor/#itemtype#</em>.
				The backend interfaces are accessible through <em>/janitor/admin/#itemtype#/list</em>
				in the browser. Fx. you can start adding <em>post</em>'s to you site by adding a 
				link to <em>/janitor/admin/post/list</em> in your main-janitor navigation – and use it.
			</p>
			<p>
				You should of 
				course <strong>never edit the files directly in the submodules</strong> - if you need to change something, 
				simply copy the class, controller and/or template(s) to
				the equivalent folder in your project theme, and make your modifications there. Janitor will automatically
				use your local versions, if available.
			</p>
			<h3>Database</h3>
			<p>
				All Items are centrally controlled and indexed in the <em>items</em> table in your database. In here
				we store default properties that apply to all Itemtypes, such as <em>status</em> and 
				<em>created_at</em>, <em>modified_at</em> and 
				<em>published_at</em> timestamps. The <em>items</em> table also contains an autogenerated <em>sindex</em> value 
				for each item, allowing us to create more semantic and meaningful links to our items.
			</p>
			<p>
				Itemtype specific data are stored in separate tables, named <em>item_#itemtype#</em>. These
				<em>item</em> tables are all following the same base structure, containing an <em>id</em>, 
				<em>item_id</em> and <em>name</em> - and on top of that the columns needed to store the
				specific data of your model.
			</p>
			<h3>Item extensions</h3>
			<p>
				Every Item in Janitor can be enriched with Tags, Comments, Mediae, Prices and a Subscription 
				method. So every item can have multiple tags, comments, images or videos associated to it.
				Any Item can become a product to sell, simply by adding a price to it. You can subscribe to
				an Item if it has a Subscription method, which enables you to create paid subscriptions
				with automatic renewal.
			</p>
			<p>
				These features are readily available for all items, you just have to enable it through the 
				backend interface. There are methods in the $JML instance (of html.janitor.class.php),
				which can be used in your templates – fx. $JML->editTags, $JML->editComments or $JML->editPrices.
				You may find examples of using these methods in <em>theme/templates/janitor/demo/edit.php</em>.
			</p>
			<h3>The <em>Items</em> class</h3>
			<p>
				Janitor provides an Items class, which is meant to help you get the item data you need,
				in order to create the interfaces most suitable for your users.
				To use the Items class, you should create a new instance like this:
			</p>
			<code>$IC = new Items();</code>
			<p>
				The Items class provides a number of methods to get Items from the database most notably
				<em>$IC->getItem</em> and <em>$IC->getItems</em>.
			</p>
			<p>
				The Items class is actually composed of the Items class extending the ItemsCore class, so while you
				create an instance of the Items class, the core methods are located in the ItemsCore class. You will
				find both files in <em>janitor/src/classes/items</em>. If your project require additional methods
				you can copy the empty items.class.php to your theme and extend Items.
			</p>

			<h2>Tasks</h2>
			<ol>
				<li>
					<h3>Update repositories</h3>
					<p>
						Pull the latest updates from <em>janitor</em>, <em>janitor_parentnode_dk</em> and <em>hwd-01</em>. 
						If you do not have these repositories, then clone them to your parentnode folder now.
					</p>
					<p>
						Also update Janitor in your own project by following step 2 and 3 in Exercise 411 again.
					</p>
				</li>
				<li>
					<h3>Add content</h3>
					<p>
						Use the model you have previously created and add some Items to the database.
					</p>
					<p>
						Add the <em>/janitor/admin/post/list</em> endpoint to your main-janitor navigation, and add
						some posts to the database as well.
					</p>
				</li>
				<li>
					<h3>Add tags</h3>
					<p>
						Tags are the cornerstone in categorizing your content in Janitor.
					</p>
					<p>
						Tags are always key:value pairs. This allows you to "categorize" your tags and add 
						additional meaning to them. You can invent new tags freely and add additional data 
						to your items through tags in all sorts of ways. Some examples of tags: "category:Sustainability",
						"type:Important", "promote:true".
					</p>
					<p>
						You can manage your tags globally under <em>Site</em> -> <em>Tags</em> in the Janitor navigation.
					</p>
				</li>
				<li>
					<h3>Inspect the tables</h3>
					<p>
						Open your database viewer (SequelPro, HeidiSQL or MySQL Workbench) and look at the 
						<em>items</em>, <em>item</em>, <em>tags</em> and <em>taggings</em> tables.
					</p>
					<p>
						We use the item and tag id to bind the data together and create relations between the tables.
						This is what it looks like behind the scene. Fortunately Janitor has some helpful methods.
					</p>
				</li>
				<li>
					<h3>The $IC instance</h3>
					<p>
						Using one of the templates you have created previously, create a new instance of the Items class
						named $IC. Just like shown above.
					</p>
					<p>
						In some cases this instance is created in the controller and thus
						available to all templates served via that controller. In those cases a simple <em>global $IC;</em>
						statement tells your template to use the $IC instance created in the controller. If your template
						already has a <em>global $IC;</em> statement, then check that the <em>$IC</em> instance is in fact 
						created in your controller.
					</p>
					<p>
						For now the <em>$IC</em> instance is not doing anything, but you should be able to view your template
						in the browser without any errors.
					</p>
					<p>
						We call this the list template.
					</p>
				</li>
				<li>
					<h3>Use $IC->getItems</h3>
					<p>
						Open the items.core.class.php in your editor and investigate the <em>getItems</em> method to understand
						which parameters it accepts. You just have to read the beginning of the method – in this case it 
						is fine to skip over the how.
					</p>
					<p>
						Try go get a selection of items from your database by sending the correct parameters to the method.
						Use the returned Items, to create a list with the names in your list template.
					</p>
					<p>
						Use <em>print_r()</em> to easily inspect the content of your variables.
					</p> 
				</li>
				<li>
					<h3>Use $IC->getItem</h3>
					<p>
						In another (or a new) template, again make sure you have access to $IC, either via the global
						instance or a local one you create.
					</p>
					<p>
						We call this the view template.
					</p>
					<p>
						Expect to receive an sindex value as a paramater via the url. That means you will get it in your 
						<em>$action</em> array and you can use it to get the specific item.
					</p>
					<p>
						Open the items.core.class.php in your editor and investigate the <em>getItem</em> method to understand
						which parameters it accepts.
					</p>
					<p>
						Try go get the specific item that matches the <em>sindex</em> and show the Item details in your view template.
					</p>
				</li>
				<li>
					<h3>Links</h3>
					<p>
						Now go back to your list template and add a link to your view to each list item 
						headline, while using the <em>sindex</em> value as an added parameter.
					</p>
					<p>
						Test that the links work.
					</p>
				</li>
				<li>
					<h3>Documentation</h3>
					<p>
						You had a look at two of the methods in items.core.class.php earlier in this exercise. 
						Now it is time to practice the fine art of documentation.
					</p>
					<p>
						The documentation for Janitor is part of the <em>janitor_parentnode_dk</em> project. You will 
						find the documentation file for the Items class in 
						<em>janitor_parentnode_dk/theme/templates/docs/class-items.php</em>. You can
						view the documentation in your browser on http://janitor.local/docs.
					</p>
					<p>
						Go to the parentNode Trello board and find the Janitor list. In the first card "Add documentation
						for Items" there is a list of updates to be performed. Start from the beginning. Coordinate
						with your classmates.
					</p>
				</li>
			</ol>
		</div>

	</div>
	<div id="footer"></div>
</div>

</body>
</html>